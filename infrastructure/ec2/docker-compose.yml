version: '3.8'

services:
  decision-simulation:
    build:
      context: ../../services/decision-simulation
      dockerfile: Dockerfile
    container_name: decision-simulation-service
    ports:
      - "8003:8003"
    environment:
      - PORT=8003
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - RAG_ENABLED=true
      - VECTOR_STORE_PATH=/app/vector_stores/chroma_db
      - VECTOR_STORE_COLLECTION=apartment_kb
      - EMBEDDING_MODEL=all-MiniLM-L6-v2
      - RAG_TOP_K=5
      - RAG_SIMILARITY_THRESHOLD=0.7
      - AWS_REGION=${AWS_REGION:-us-west-2}
    volumes:
      - chroma-data:/app/vector_stores/chroma_db
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8003/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  chroma-data:
    driver: local

networks:
  default:
    name: synergy-network

